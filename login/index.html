<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="../external/bootstrap.min.css">
  <link rel="stylesheet" href="../index.css">
  
  <script src="../external/jquery-3.3.1.min.js"></script>
  <script src="../external/popper.min.js"></script>
  <script src="../external/bootstrap.min.js"></script>
  <script src="../external/Dropbox-sdk.min.js"></script>

  <script src="../devVersion.js"></script>
  <script src="./homepage.js" defer></script>


  <title>PBoard</title>
</head>


<body class="">
<main role="main">

  <div class="modal-dialog" style="max-width: 90% !important; width: 700px !important;">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">PBoard</h4>
        </div>
        <div class="modal-body">
          <a>Project and idea management and categorization tool inspired by Trello</a>
          </br>
          </br>
          <a>Hosted on github, uses google drive for storage (single json file)</a>
        </div>
        <!--
        <form id="form" class="modal-footer" onsubmit="event.preventDefault(); loadFromDropbox();">
          <input id="token" name="d" type="text" placeholder="Dropbox access token" class="form-control" autocomplete="on">
          <input type="submit" class="btn btn-primary" value="Open">
        </form>
        -->
        <button style="display: none;" id="authorize_button" class="btn btn-primary" value="Authorize with Google Drive">
        <button id="signout_button" style="display: none;">Sign Out</button>

      </div>
    </div>
  
<!--
  <form action="/pboarddev">
      <div class="container-fluid">
        <div class="input-group mb-3 jumbotron bg-dark">
          <input id="token" name="d" type="text" placeholder="Dropbox access token" class="form-control bg-dark text-white" autocomplete="on">
          <div class="input-group-append">
            <button id="loginBtn" class="btn btn-outline-secondary" type="submit">Open boards</button>
          </div>
        </div>
      </div>
    </form>
-->


</main>



<!-- Google Drive API -->
<div>

  <!--Add buttons to initiate auth sequence and sign out-->

  <pre id="content" style="white-space: pre-wrap;"></pre>

  <script type="text/javascript">


    var authorizeButton = document.getElementById('authorize_button');
    var signoutButton = document.getElementById('signout_button');

    /**
     *  On load, called to load the auth2 library and API client library.
     */
    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    /**
     *  Initializes the API client library and sets up sign-in state
     *  listeners.
     */
    function initClient() {
      gapi.client.init({
        apiKey: 'AIzaSyDXQ9Z_V5TSX-yepF3DYKVjTIWVwpwuoXU',
        clientId: '644898318398-d8rbskiha2obkrrdfjf99qcg773n789i.apps.googleusercontent.com',
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
        scope: 'https://www.googleapis.com/auth/drive.metadata.readonly' //space separated
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = handleAuthClick;
        signoutButton.onclick = handleSignoutClick;
      }, function(error) {
        appendPre(JSON.stringify(error, null, 2));
      });
    }

    /**
     *  Called when the signed in status changes, to update the UI
     *  appropriately. After a sign-in, the API is called.
     */
    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'block';
        listFiles();
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display = 'none';
      }
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }

    /**
     * Append a pre element to the body containing the given message
     * as its text node. Used to display the results of the API call.
     *
     * @param {string} message Text to be placed in pre element.
     */
    function appendPre(message) {
      var pre = document.getElementById('content');
      var textContent = document.createTextNode(message + '\n');
      pre.appendChild(textContent);
    }

    /**
     * Print files.
     */
    function listFiles() {
      gapi.client.drive.files.list({
        'pageSize': 10,
        'fields': "nextPageToken, files(id, name)"
      }).then(function(response) {
        appendPre('Files:');
        var files = response.result.files;
        if (files && files.length > 0) {
          for (var i = 0; i < files.length; i++) {
            var file = files[i];
            appendPre(file.name + ' (' + file.id + ')');
          }
        } else {
          appendPre('No files found.');
        }
      });
    }

  </script>

  <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
</div>

</body>




<footer class="text-muted bg-dark">

      <p class="float-right">
      </p>
      <p>Made by <a href="https://github.com/lukakostic"> Luka Kostic</a></p>

  </footer>

</html>